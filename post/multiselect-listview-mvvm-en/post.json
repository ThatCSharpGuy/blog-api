{	
	"id" : "/post/multiselect-listview-mvvm-en/",
	"tv" : false,
	"date": "2016-03-23 02:00:00 -0600",
	"title" : "Multi-select ListView and MVVM",
	"author" : "Antonio Feregrino Bola√±os",
	"featured_image": "http://thatcsharpguy.com/postimages//xamarin-forms/multiselect-featured.png",
	"tags" : ["XamarinForms","Xamarin"],
	  
	"content": '"Finally I was able to develop something using Xamarin.Forms and part of what I've been doing had to do with implementing a list that allowed the multiple election of rows and was compatible with the MVVM pattern.  \n\nDoing some research, I found that the `ListView` control, which is the most used to show data in a list, does not allow multiple selection and developers should find a workaround to this matter. In Xamarin documentation there is also <a href=\"https://developer.xamarin.com/recipes/cross-platform/xamarin-forms/controls/multiselect/\" target=\"_blank\" rel=\"nofollow\">an article</a> where it is explained a way to complete this task, and this post is based on it. \n  \nTo make this task possible, we should make use of some auxiliary classes that I will explain later on this post.\n\n### The Model  \nFor this example, we will be showing a list of Pokemons and allow the user to select some of them through a list, the model class is the following:\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">npublic</span> <span class="k">class</span> <span class="nc">Pokemon</span> <span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span>    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span>    <span class="k">public</span> <span class="kt">double</span> <span class="n">Weight</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span>    <span class="k">public</span> <span class="kt">double</span> <span class="n">Height</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span></code></pre></figure>  \n\n### SelectableItemWrapper&lt;T&gt;\nApart from the model, there is a need from an auxiliary class that you can tell by the name, acts as wrapper for the model, its definition is the following:\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">npublic</span> <span class="k">class</span> <span class="nc">SelectableItemWrapper</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsSelected</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span>    <span class="k">public</span> <span class="n">T</span> <span class="n">Item</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span></code></pre></figure>    \n\nThe `IsSelected` property will be used to determine whether the user had selected an item or not, while `Item` will contain the model.\n\n## The View\n(Si prefieres trabajar solo con C#, <a href=\"//thatcsharpguy.com/post/multiselect-listview-mvvm\">ve este post</a>)\n\nFor this app we will use two Forms pages, one to show all the Pokemons and other to show only those who had been selected by the user. \n\nFor the first one, where all the Pokemons will be shown, we will have to modify slightly the way we are used to create a cell template, and the reason is that every row in the list will be binded to a `SelectableItemWrapper<Pokemon>` not to a `Pokemon`.  \n\nThe list will be declared in XAML and the collection `Pokemons` will be set as the `ItemSource` property:\n\n<figure class="highlight"><pre><code class="language-xml" data-lang="xml">\n<span class="nt">&lt;ListView</span> <span class="na">ItemsSource=</span><span class="s">\&quot;{Binding</span> <span class="err">Pokemons}\&quot;</span><span class="nt">&gt;</span>\n</code></pre></figure>  \n\nAs we know, now every element in the collection will be a row in the list.\n\n#### PokemonSelectableCell\nFor this cell it is necessary to show the name, weight and height of the Pokemon binded to it, along with a control to let the user choose or not such item. That is why some bindable properties are needed.\n\nThat is why in order to show the information three labels are created, and for the selection issue a `Switch` control will be used (I tried to use the <a href=\"https://github.com/XLabs/Xamarin-Forms-Labs/wiki/Checkbox-Control\" target=\"_blank\" rel=\"nofollow\">CheckBox de XLabs</a>, but I ran into an issue with the `ListView`).  \n\nYou can design the cell as you want, but it is important that inside of it you bind a boolean property, such as `IsToggled` o `Checked`, to the property `IsSelected` of the `SelectableItemWrapper` class. For this example, a line like this should be enough:\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">n</span><span class="c1">// Important:\nsw.SetBinding(Switch.IsToggledProperty, \&quot;IsSelected\&quot;);\n</span></code></pre></figure>  \n\nI should remark that the binding is defined within the cell implementation, and not in the view where the bindings are usually defined.\n\n### Back to the View\nNow, again back to the view, we can use the cell in our `ListView`, we can define other bindings:\n\n<figure class="highlight"><pre><code class="language-xml" data-lang="xml">\n<span class="nt">&lt;ListView.ItemTemplate&gt;</span>\n    <span class="nt">&lt;DataTemplate&gt;</span>\n        <span class="nt">&lt;c:PokemonSelectableCell</span> <span class="err">\n</span>            <span class="na">Name=</span><span class="s">\&quot;{Binding</span> <span class="err">Item.Name}\&quot;</span> <span class="err">\n</span>            <span class="na">Weight=</span><span class="s">\&quot;{Binding</span> <span class="err">Item.Weight}\&quot;</span> <span class="err">\n</span>            <span class="na">Height=</span><span class="s">\&quot;{Binding</span> <span class="err">Item.Height}\&quot;</span> <span class="nt">/&gt;</span>\n</code></pre></figure>  \n\nYou can notice that te binding routes aren't \"direct\", instead we are referring first to an `Item` before the *real* properties, that is because we are binding to a `SelectableItemWrapper<Pokemon>`, not to a `Pokemon`. \n\n### The ViewModel\nFor the ViewModel we require two collections:\n\n - One to hold a list of all Pokemons \n - One to hold the selected Pokemons  \n \nHere are the definitions for them:\n \n <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">nprivate</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">SelectableItemWrapper</span><span class="p">&lt;</span><span class="n">Pokemon</span><span class="p">&gt;&gt;</span> <span class="n">_pokemons</span><span class="p">;</span><span class="err">\</span><span class="n">npublic</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">SelectableItemWrapper</span><span class="p">&lt;</span><span class="n">Pokemon</span><span class="p">&gt;&gt;</span> <span class="n">Pokemons</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_pokemons</span><span class="p">;</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span>    <span class="k">set</span> <span class="p">{</span> <span class="n">_pokemons</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="n">RaisePropertyChanged</span><span class="p">();</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="n">nprivate</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">Pokemon</span><span class="p">&gt;</span> <span class="n">_selectedPokemons</span><span class="p">;</span><span class="err">\</span><span class="n">npublic</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">Pokemon</span><span class="p">&gt;</span> <span class="n">SelectedPokemons</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_selectedPokemons</span><span class="p">;</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span>    <span class="k">private</span> <span class="k">set</span> <span class="p">{</span> <span class="n">_selectedPokemons</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="n">RaisePropertyChanged</span><span class="p">();</span> <span class="p">}</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span></code></pre></figure>  \n\nThe first one, `Pokemons` is an `ObservableCollection` of `SelectableItemWrapper` of `Pokemon` because it holds all the selectable items. Whereas the second one is just another collection. Like the ones we are used to.\n\nTherefore, in the ViewModel we can get all the selected items using a simple Linq query:\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">nObservableCollection</span><span class="p">&lt;</span><span class="n">Pokemon</span><span class="p">&gt;</span> <span class="n">GetSelectedPokemons</span><span class="p">()</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="kt">var</span> <span class="n">selected</span> <span class="p">=</span> <span class="n">Pokemons</span><span class="err">\</span><span class="n">n</span>        <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">IsSelected</span><span class="p">)</span><span class="err">\</span><span class="n">n</span>        <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Item</span><span class="p">)</span><span class="err">\</span><span class="n">n</span>        <span class="p">.</span><span class="n">ToList</span><span class="p">();</span>   <span class="err">\</span><span class="n">n</span>    <span class="k">return</span> <span class="k">new</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">Pokemon</span><span class="p">&gt;(</span><span class="n">selected</span><span class="p">);</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span></code></pre></figure>  \n\nOr mark all or none items as selected:\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">nvoid</span> <span class="n">SelectAll</span><span class="p">(</span><span class="kt">bool</span> <span class="k">select</span><span class="p">)</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">Pokemons</span><span class="p">)</span><span class="err">\</span><span class="n">n</span>    <span class="p">{</span><span class="err">\</span><span class="n">n</span>        <span class="n">p</span><span class="p">.</span><span class="n">IsSelected</span> <span class="p">=</span> <span class="k">select</span><span class="p">;</span><span class="err">\</span><span class="n">n</span>    <span class="p">}</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span></code></pre></figure>  \n\nAnd all of that, from the ViewMdoel. Remember, you can always  <a href=\"https://github.com/ThatCSharpGuy/MultiPokeList\" target=\"_blank\">check the source code</a>. By the way, look at the finished app:\n\n<img src=\"http://i.giphy.com/qpfRFj3MrFqow.gif\" title=\"Multi-select ListView y MVVM\" />\n\n\n#### Credits\nThe class `SelectMultipleBasePage<T>` in which all the info in this post is based on, was written by Glenn Stephens from Xamarin University, <a href=\"https://developer.xamarin.com/recipes/cross-platform/xamarin-forms/controls/multiselect/\" target=\"_blank\" rel=\"nofollow\">see the original post</a>."'   
}