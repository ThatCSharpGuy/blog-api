{	
	"id" : "/post/clases-partial-c-sharp/",
	"tv" : false,
	"date": "2016-06-06 14:00:01 -0500",
	"title" : "Clases parciales en C#",
	"author" : "Antonio Feregrino Bolaños",
	"featured_image": "http://thatcsharpguy.com/postimages//aprende-c-sharp/partial-featured.png",
	"tags" :
	[ 
		"AprendeCSharp"
	],
	"content" : "<p>Esta vez toca hablar de otra de las características de C# (y de .NET en general). Esta vez son las clases parciales.</p>

<p>Tal vez alguna vez te hayas encontrado con que, en la declaración de una clase, la palabra <code>partial</code> está antepuesta a la palabra <code>class</code>. Pero, ¿qué significa esto?</p>

<p>Que una clase esté marcada como <code>partial</code> o parcial, significa que la definición de esta puede estar distribuida en más de un bloque de código. Por ejemplo, mira la definición completa de la clase <code>Program</code>:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">namespace</span> <span class="nn">Parciales</span>
<span class="p">{</span>
    <span class="c1">// Block 1</span>
    <span class="k">partial</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Write</span><span class="p">(</span><span class="n">HelloWorldString</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="c1">// Class constants. Block 2</span>
<span class="k">partial</span> <span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">HelloWorldString</span> <span class="p">=</span> <span class="err">\</span><span class="s">&quot;Hola mundo!\&quot;;</span>
<span class="p">}</span> <span class="p">}</span> </code></pre></figure>  
</code></pre>

<p>En este caso, la clase está declarada en dos bloques.</p>

<p>Esto parece no muy útil, ¿cierto? sin embargo, la ventaja de las clases parciales es que nos permite separar la definición de una clase a través de varios archivos, por ejemplo, podríamos tener el archivo <em>Program.cs</em> y el archivo <em>ProgramMethods.cs</em> para separar la programación de la clase. En el ejemplo anterior, el método <code>Write</code> está definido en otro archivo, que contiene otra definición parcial de la clase:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">partial</span> <span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="kt">string</span> <span class="n">line</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure></p>

<p>Cuando llega el momento de compilar, <strong>el compilador tomará todas las definiciones parciales de una clase y la convertirá en una sola</strong>, es por eso que si escribimos la misma firma de método o nombre de propiedad en dos archivos diferentes obtendremos un error de compilación.</p>

<p>Y… eso es todo lo que necesitas saber sobre clases parciales.</p>

<p>¡NO! aguarda, aún hay más. La posibilidad de dividir la definición de una clase en múltiples archivos es una de las más criticadas, ya que usada sin cuidado puede transformar tu código (y los archivos en los que está definido) en un verdadero laberinto. Es por eso que hay ciertos escenarios en los que su uso es recomendado y fuera de ellos su uso debería ser restringido.</p>

<p>Veamos algunos de los usos comunes:</p>

<h3 id=\"definicin-de-interfaz-grfica\">Definición de interfaz gráfica</h3>
<p>Si has trabajado con tecnologías como Windows Forms, Web Forms, y más reciente, Xamarin Forms, tal vez te hayas dado cuenta que junto a la definición de la interfaz gráfica (un archivo .aspx o .xaml) se genera automáticamente un archivo que contiene una clase parcial en donde están declarados los controles que definiste en la pantalla. A su vez existe otro archivo en el que tu puedes escribir la lógica de tu aplicación.</p>

<p>Es decir, existe un archivo para la interfaz y otro para la lógica, esto resulta bastante útil ya que nos evita correr el riesgo de modificar el código que define la interfaz y nos quita de la vista código que realmente nosotros nunca escribimos por nuestra cuenta.</p>

<p><small>Aún recuerdo cuando usé NetBeans con Java Swing. Seguramente también recuerdas ese bloque enorme de código que no puedes modificar… ewww</small></p>

<p>Por ejemplo, mira estas clases, tal vez re recuerden algo:</p>

<div class=\"pure-g\">
<div class=\"pure-u-1 pure-u-md-1-2\">

<h4>Lógica</h4>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Page</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">Page</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">InitializeComponent</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">Control1</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">Control2</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">Control3</span><span class="p">);</span>        
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>  
</div>
<div class=\"pure-u-1 pure-u-md-1-2\">

<h4>Código generado</h4>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="c1">// This code was generated by a tool, </span>
<span class="c1">// any changes made to this file will be discarded</span>
<span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Page</span>
<span class="p">{</span>
    <span class="kt">object</span> <span class="n">Control1</span><span class="p">;</span>
    <span class="kt">object</span> <span class="n">Control2</span><span class="p">;</span>
    <span class="kt">object</span> <span class="n">Control3</span><span class="p">;</span>

    <span class="k">void</span> <span class="nf">InitializeComponent</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...code</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>  
</div>  
</div>

<h3 id=\"reutilizar-cdigo\">Reutilizar código</h3>
<p>Otro buen uso surgió junto con los <em>shared projects</em>, y es que con ellos podemos concentrar el código que se puede compartir en un solo archivo y dejar las implementaciones específicas para cada plataforma. el de abajo es un ejemplo muy burdo, pero te puede dar una idea:</p>

<p><strong>Core.cs</strong> en el proyecto compartido
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Core</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">Core</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="cp">#if &lt;strong&gt;ANDROID&lt;/strong&gt;</span>
        <span class="kt">int</span> <span class="n">camera</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="kt">string</span> <span class="n">options</span> <span class="p">=</span> <span class="err">“”</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">photo</span> <span class="p">=</span> <span class="n">TakePhoto</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
        <span class="cp">#elif &lt;strong&gt;IOS&lt;/strong&gt;</span>
        <span class="kt">string</span> <span class="n">camera</span> <span class="p">=</span> <span class="err">“”</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">photo</span> <span class="p">=</span> <span class="n">TakePhoto</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
        <span class="cp">#endif&lt;/p&gt;</span>

<span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span>    <span class="kt">int</span> <span class="n">byteCount</span> <span class="p">=</span> <span class="n">photo</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
<span class="p">}</span> <span class="p">}</span> </code></pre></figure> 
</code></pre>

<p><strong>CoreAndroid.cs</strong> en el proyecto de Android
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Core</span>
<span class="p">{</span>
    <span class="kt">byte</span><span class="p">[]</span> <span class="nf">TakePhoto</span><span class="p">(</span><span class="kt">int</span> <span class="n">camera</span><span class="p">,</span> <span class="kt">string</span> <span class="n">options</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure></p>

<p><strong>CoreiOS.cs</strong> en el proyecto de iOS
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Core</span>
<span class="p">{</span>
    <span class="kt">byte</span><span class="p">[]</span> <span class="nf">TakePhoto</span><span class="p">(</span><span class="kt">string</span> <span class="n">camera</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure></p>

<h2 id=\"trabajo-en-equipo\">Trabajo en equipo</h2>
<p>Con anterioridad se recomendaba que si varios programadores trabajaban en una clase, esta se dividiera en varios archivos para hacer <em>más</em> sencillo el trabajo a la hora de juntar los cambios, actualmente podemos usar con más seguridad algún <a href=\"http://localhost:4000/tv/control-versiones/\">sistema de control de versiones</a> para la misma tarea.</p>

<h2 id=\"simplificar-el-cdigo\">“Simplificar” el código</h2>
<p>Eh, pues simplemente eso, “simplificar” una clase larga para facilitar su lectura. En realidad, creo que si tienes una clase muy grande, antes de considerar separarla en varios archivos, debes considerar repasar tu diseño de aplicación y separar tu clase en varias clases. Si después de pensarlo, usar clases parciales sigue siendo la única opción, pues lo puedes hacer.</p>

<h3 id=\"lo-que-sigue\">Lo que sigue</h3>
<p>No olvides que puedes <a href=\"https://github.com/ThatCSharpGuy/aprende-c-sharp/tree/master/Parciales\" target=\"_blank\" rel=\"nofollow\">descargar el código fuente</a> para que hagas pruebas con él.</p>

<p>Volviendo a las clases parciales, los mejores casos de uso son para herramientas que generan código o para maximizar la cantidad de código compartido, fuera de esos escenarios, su uso es bastante criticado ya que, si abusas de ellas, el código se puede tornar confuso al estar distrinuído en distintos archivos. Como siempre, nunca está de más conocer otra herramienta para cuando llega el momento de programar.</p>
"
}