{	
	"id" : "/post/extension-methods-es/",
	"tv" : false,
	"date": "2016-11-15 13:00:01 -0600",
	"title" : "Métodos de extensión en C#",
	"author" : "Antonio Feregrino Bolaños",
	"featured_image": "http://thatcsharpguy.com/postimages//aprende-c-sharp/extension.png",
	"tags" :
	[ 
		"AprendeCSharp"
	],
	"content" : "<p>Seguramente conoces los <a href=\"..\metodos-c-sharp\" target=\"_blank\">métodos en C#</a>, pero has de saber que no es la “únicos” clase de métodos que podemos usar en este lenguaje. También existen otros llamados <strong>métodos de extensión</strong> o <strong>extension methods</strong>, que como su nombre lo indica nos ayudan a “extender” la funcionalidad de nuestros tipos de dato.</p>

<p>Para comenzar, mira el siguiente código:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">secuencia</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[]</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span> <span class="p">};</span>
<span class="kt">var</span> <span class="n">resultado</span> <span class="p">=</span> <span class="n">Enumerable</span><span class="p">.</span><span class="n">Take</span><span class="p">(</span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">secuencia</span><span class="p">,</span> <span class="n">i</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">i</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">),</span> <span class="m">1</span><span class="p">);</span></code></pre></figure></p>

<p>¿Te resulta familiar? (si no, te recomiendo que veas mi post sobre <a href=\"..\linq-en-c-sharp\" target=\"_blank\">linq en C#</a>). Seguramente recuerdas los métodos <code>Take</code> y <code>Where</code>, de linq salvo que esta vez los estamos usando con su sintaxis original. El resultado de lo anterior es idéntico a lo que obtendríamos de ejecutar el siguiente código:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">resultado</span> <span class="p">=</span> <span class="n">secuencia</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">i</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">i</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">).</span><span class="n">Take</span><span class="p">(</span><span class="m">1</span><span class="p">);</span></code></pre></figure></p>

<p>Mucho más limpio y fácil de recordar.</p>

<h2 id=\"crendolos\">Creándolos</h2>
<p>Imagina, por ejemplo, que por alguna razón extraña del destino, en tus apps necesitas cambiar las letras minúsculas por mayúsculas, una (mala) opción sería copiar y pegar el código, otra sería crear un método tradicional y compartirlo, o… ¡puedes crear tus métodos genéricos!</p>

<p>Para crear métodos de extensión es necesario lo siguiente:</p>

<ul>
  <li>Crear una clase estática para definir los métodos</li>
  <li>Convertir el método deseado a estático con la palabra <code>static</code></li>
  <li>Anteponer la palabra <code>this</code> al primer elemento de la lista de parámetros del método</li>
</ul>

<p>Vamos a crear unas extensiones para <code>char</code>, comenzamos con la clase que los contendrá, yo acostumbro ponerle como nombre el tipo de dato más el prefijo <code>Extensions</code>:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">CharExtensions</span><span class="p">&lt;</span><span class="n">br</span> <span class="p">/&gt;</span>
<span class="p">{</span></code></pre></figure></p>

<p>Dentro de esa clase crearemos un método para “voltear” un caracter, es decir, para convertirlo a mayúscula si es minúscula y viceversa:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">public</span> <span class="k">static</span> <span class="kt">char</span> <span class="nf">Flip</span><span class="p">(</span><span class="k">this</span> <span class="kt">char</span> <span class="n">c</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Char</span><span class="p">.</span><span class="n">IsUpper</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">?</span> <span class="n">Char</span><span class="p">.</span><span class="n">ToLower</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">:</span><span class="n">Char</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="p">}</span></code></pre></figure></p>

<p>Ahora vamos a crear algo similar pero para cadenas:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">StringExtensions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">Flip</span><span class="p">(</span><span class="k">this</span> <span class="kt">string</span> <span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="n">Int32</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="k">return</span> <span class="err">“”</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">str</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">str</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">n</span><span class="p">)</span>
                <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Flip</span><span class="p">();</span>
            <span class="k">else</span>
                <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="p">(</span><span class="n">array</span><span class="p">);</span>
    <span class="p">}</span></code></pre></figure></p>

<p>En el código de arriba puedes ver cómo es que ya comenzamos a hacer uso de nuestro método de extensión <code>Flip</code> para caracteres. También puedes ver que un método de esta clase puede aceptar más argumentos (en este caso <code>n</code>) además del elemento sobre el que se va a aplicar.</p>

<h3 id=\"el-namespace\">El namespace</h3>
<p>Para estos métodos, el <em>namespace</em> en el que estén ubicados es de vital importancia. Por ejemplo, si no declaramos <code>System.Linq</code> en los <em>usings</em> de nuestro código, no podremos hacer uso de los métodos <code>Where</code>, <code>Take</code>, etc. En el <a href=\"https://github.com/ThatCSharpGuy/aprende-c-sharp/tree/master/ExtensionMethods\" target=\"_blank\">ejemplo anterior</a> el namespace de las extensiones es <code>Extensiones</code>, es por eso que debemos añadir <code>using Extensiones</code> para poder acceder a ellos desde cualquier parte del código.</p>

<p>Entonces ya podríamos usarlos en donde queramos:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="n">HOLA</span> <span class="n">mundo</span><span class="p">!</span><span class="err">”</span><span class="p">.</span><span class="n">Flip</span><span class="p">());</span> <span class="c1">// Imprime: “hola MUNDO!”</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="n">HOLA</span> <span class="n">mundo</span><span class="p">!</span><span class="err">”</span><span class="p">.</span><span class="n">Flip</span><span class="p">(</span><span class="m">7</span><span class="p">));</span> <span class="c1">// Imprime “hola MUndo!”</span></code></pre></figure></p>

<h3 id=\"miembros-privados\">Miembros privados</h3>
<p>La sintaxis te puede hacer pensar que dentro de ellos puedes acceder a los miembros privados de las clases sobre las que operan, pero no es así. Para el método de extensión el tipo sobre el que funciona no es más que otro argumento, como veremos un poco más adelante.</p>

<h2 id=\"compatibilidad\">Compatibilidad</h2>
<p>Puedes hacer estos métodos para cualquier tipo de dato, desde aquellos que son <a href=\"..\tipos-dato-c-sharp\" target=\"_blank\">por valor a los que son por referencia</a>, desde clases abstractas hasta interfaces, ah, y cómo olvidar a los tipos genéricos.</p>

<h2 id=\"nullreferenceexception\">¿NullReferenceException?</h2>
<p>Los métodos de extensión solo son azúcar sintáctica como te habrás dado cuenta, ya que cualquier llamada a un método de extensión se traduce a una llamada a un método estático dentro de una clase estática, pasando como primer argumento el elemento a la izquierda del operador <code>.</code>, esto se puede comprobar a través de un decompilador… o simplemente ejecutando el siguiente código:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">string</span> <span class="n">n</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="k">null</span> <span class="p">=</span> <span class="err">“</span> <span class="p">+</span> <span class="n">n</span><span class="p">.</span><span class="n">Flip</span><span class="p">());</span> <span class="c1">// Imprime: “null = “</span></code></pre></figure></p>

<p>Si nosotros intentáramos llamar cualquier método de la clase <code>string</code> sobre la variable <code>n</code>, obtendríamos una <code>NullReferenceException</code>, sin embargo, con este tipo de métodos no es así, dado que <strong>el método no se invoca sobre el objeto</strong>, para él, nuestra variable <code>n</code> no es más que otro argumento.</p>

<h2 id=\"usos\">Usos</h2>

<p>El ejemplo más claro del uso de los métodos es <code>System.Linq</code>. Sin embargo, como te podrás imaginar, los usos que les puedes dar son ilimitados, inclusive podrías crear tu propia biblioteca de métodos de extensión para reutilizar en tus proyectos… o reutilizar algunos que ya hacen uso de ellos como <a href=\"..\humaniza-tus-apps\" target=\"_blank\">Humanizer</a>, <a href=\"..\flurl\" target=\"_blank\">Flurl</a> o <a href=\"https://github.com/morelinq/MoreLINQ\" target=\"_blank\">MoreLINQ</a>.</p>
"
}