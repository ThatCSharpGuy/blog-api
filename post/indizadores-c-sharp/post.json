{	
	"id" : "/post/indizadores-c-sharp/",
	"tv" : false,
	"date": "2016-12-27 13:00:02 -0600",
	"title" : "Sobrecarga de indizadores en C#",
	"author" : "Antonio Feregrino Bolaños",
	"featured_image": "http://thatcsharpguy.com/postimages/aprende-c-sharp/indexers.jpg",
	"tags" :
	[ 
		"AprendeCSharp"
	],
	"content" : "<p>Seguramente estás muy, pero muy familiarizado con el tema del que hablaré en este post, y es que, ¿quién no ha utilizado algo así: <code>lista[0] = 9;</code> en sus programas?</p>

<p>A esta sintaxis se le coonoce como <em>indizadores</em>. Es muy común que la has visto antes en colecciones, como en arreglos y la clase <code>List</code>, sin embargo, es muy poco conocido que nosotros, como desarrolladores, podemos permitir que otros desarrolladores usen esta sintaxis en las clases que nosotros creamos.</p>

<p>Podemos ver a los corchetes cuadrados como un operador de acceso a los elementos de determinada instancia, como es el caso de las listas, arreglos o diccionarios. Y aunque su uso se recomienda precisamente para eso (<strong>acceso a los elementos de una colección</strong>), podemos darle otros usos. Pero antes de ver cómo funcionan, vamos a ver la sintaxis.</p>

<h2 id=\"sintaxis\">Sintaxis</h2>
<p>Para implementar un indizador en nuestros tipos de dato tenemos que seguir una sintaxis que resulta un poco extraña cuando la vez:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="p">&lt;/</span><span class="n">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">public</span> <span class="kt">int</span> <span class="k">this</span><span class="p">[</span><span class="kt">int</span> <span class="n">index</span><span class="p">]</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="cm">/* Regresa un tipo entero &lt;em&gt;/ }</span>
<span class="cm">    set { /&lt;/em&gt; Establece el valor de “value” que es de tipo entero */</span> <span class="p">}</span>
<span class="p">}</span> <span class="p">&lt;</span><span class="n">br</span> <span class="p">/&gt;</span></code></pre></figure></p>

<p>En general, para crear un indizador debemos escribir lo siguiente:</p>

<ul>
  <li>El modificador de acceso (public, internal, private…)</li>
  <li>El tipo de dato del indizador.</li>
  <li>La palabra reservada <code>this</code>.</li>
  <li>Los parámetros del indizador entre corchetes cuadrados.</li>
  <li>La especificación del acceso mediante bloques: lectura con <code>get</code>, escritura con <code>set</code>.</li>
  <li>*Si especificamos <code>get</code> debemos regresar un valor en el bloque.</li>
  <li>*Si especificamos <code>set</code> tenemos a nuestra disposición el identificador <code>value</code> que hace referencia al valor que debe ser asignado.</li>
</ul>

<p>Supón que tenemos una clase especificada de la siguiente manera:<br />
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Indexer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="k">this</span><span class="p">[</span><span class="kt">string</span> <span class="n">position</span><span class="p">]</span>
    <span class="p">{</span>
        <span class="k">get</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="n">Accediendo</span> <span class="n">a</span> <span class="p">{</span><span class="m">0</span><span class="p">}</span><span class="err">”</span><span class="p">,</span> <span class="n">position</span><span class="p">);</span>
            <span class="k">return</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// Importante regresar un dato</span>
        <span class="p">}</span>
        <span class="k">set</span>
        <span class="p">{</span>
            <span class="c1">// value contiene el dato que se va a establecer</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="n">Estableciendo</span> <span class="p">{</span><span class="m">0</span><span class="p">}</span> <span class="n">en</span> <span class="n">la</span> <span class="n">posición</span> <span class="p">{</span><span class="m">1</span><span class="p">}</span><span class="err">”</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">position</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure></p>

<p>Que define un indizador de tipo <code>int</code> que como índice usa un tipo <code>string</code>. Entonces al ejecutar el siguiente código:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">indizador</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Indexer</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">retorno</span> <span class="p">=</span> <span class="n">indizador</span><span class="p">[</span><span class="err">“</span><span class="n">hola</span><span class="err">”</span><span class="p">];</span>
<span class="n">indizador</span><span class="p">[</span><span class="err">“</span><span class="n">feliz</span><span class="err">”</span><span class="p">]</span> <span class="p">=</span> <span class="m">2017</span><span class="p">;</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="n">Valor</span> <span class="n">de</span> <span class="n">retorno</span> <span class="p">{</span><span class="m">0</span><span class="p">}</span><span class="err">”</span><span class="p">,</span> <span class="n">retorno</span><span class="p">);</span></code></pre></figure></p>

<p>Obtendremos en la pantalla:</p>

<pre>
Accediendo a hola
Estableciendo 2017 en la posición feliz
Valor de retorno 0
</pre>

<p>Es importante notar que como parámetros del indizador podemos usar cualquier tipo de dato, no solo enteros o cadenas. Como en el siguiente ejemplo que se emplea un tipo <code>Indexer</code> como indizador y solo se implementa el bloque <code>get</code>:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="kt">string</span> <span class="k">this</span><span class="p">[</span><span class="n">Indexer</span> <span class="n">indexer</span><span class="p">]</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">indexer</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// …</span>
<span class="kt">var</span> <span class="n">otroIndizador</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Indexer</span><span class="p">();</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">indizador</span><span class="p">[</span><span class="n">otroIndizador</span><span class="p">]);</span> <span class="c1">// Imprime: “Indizadores.Indexer”</span></code></pre></figure></p>

<p>O en este otro ejemplo, en donde se usa un tipo <code>double</code> como parámetro para un índice del tipo <code>Indexer</code>. En él se implementa únicamente el bloque <code>set</code>:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="n">Indexer</span> <span class="k">this</span><span class="p">[</span><span class="kt">double</span> <span class="n">position</span><span class="p">]</span>
<span class="p">{</span>
    <span class="k">set</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“\</span><span class="s">&quot;Insertando\&quot; {1} en {0}”, position, value); }</span>
<span class="p">}</span>
<span class="c1">// …</span>
<span class="n">indizador</span><span class="p">[</span><span class="m">123.456d</span><span class="p">]</span> <span class="p">=</span> <span class="n">otroIndizador</span><span class="p">;</span> <span class="c1">// Mostrará en pantalla: “Insertando” Indizadores.Indexer en 123.456</span></code></pre></figure></p>

<p>Podemos usar cualquier cantidad de índices, así como regresar cualquier tipo de dato, por ejemplo, podemos tener un indizador que acepte 3 parámetros de tipo <code>int</code>, <code>bool</code> y <code>double</code> y regrese una cadena:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="kt">string</span> <span class="k">this</span><span class="p">[</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">b</span><span class="p">,</span> <span class="kt">double</span> <span class="n">d</span><span class="p">]</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="err">“</span><span class="n">I</span><span class="err">’</span><span class="n">m</span> <span class="n">an</span> <span class="n">indexer</span><span class="p">:</span> <span class="p">{</span><span class="m">0</span><span class="p">}</span> <span class="p">{</span><span class="m">1</span><span class="p">}</span> <span class="p">{</span><span class="m">2</span><span class="p">}</span><span class="err">”</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="c1">//&lt;/p&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="kt">var</span> <span class="n">resultado1</span> <span class="p">=</span> <span class="n">indizador</span><span class="p">[</span><span class="m">10</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="m">10</span><span class="p">];</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">resultado1</span><span class="p">);</span> <span class="c1">// Imprime: “I’m an indexer: 10 False 5”</span></code></pre></figure></p>

<p>En cierto modo podemos ver los indizadores como una especie de métodos con algunas restricciones, entre ellas la de que sus índices no pueden ser del tipo <a href=\"../out-ref-c-sharp\" target=\"_blank\"><code>out</code> o <code>ref</code></a>.</p>

<p>Al final los indizadores terminan siendo transformados en métodos por el compilador, y es que solo son parte de la <a href=\"https://www.youtube.com/watch?v=Ypgw-TgT70I\" target=\"_blank\">azúcar sintáctica</a> que nos ofrece C#.</p>

<h2 id=\"por-qu-usarlos\">¿Por qué usarlos?</h2>
<p>Imagina que tienes una clase llamada <code>Alphabet</code> que almacena todas las letras de determinado alfabeto y para acceder a ellas nos ofrece un método llamado <code>CharacterAt(int position)</code> para acceder a determinado caracter dentro del alfabeto:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Alphabet</span>
<span class="p">{</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="kt">char</span><span class="p">&gt;</span> <span class="n">caracteres</span><span class="p">;</span>
    <span class="k">private</span> <span class="nf">Alphabet</span><span class="p">(</span><span class="k">params</span> <span class="kt">char</span><span class="p">[]</span> <span class="n">caracteres</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">caracteres</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">char</span><span class="p">&gt;(</span><span class="n">caracteres</span><span class="p">);</span>
    <span class="p">}&lt;/</span><span class="kt">char</span><span class="p">&gt;&lt;/</span><span class="kt">char</span><span class="p">&gt;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">public</span> <span class="kt">char</span> <span class="n">CharacterAt</span><span class="p">(</span><span class="kt">int</span> <span class="n">position</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">caracteres</span><span class="p">[</span><span class="n">position</span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">// ...</span>
<span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="kt">var</span> <span class="n">griego</span> <span class="p">=</span> <span class="n">Alphabet</span><span class="p">.</span><span class="n">Greek</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">segundaLetra</span> <span class="p">=</span> <span class="n">griego</span><span class="p">.</span><span class="n">CharacterAt</span><span class="p">(</span><span class="m">2</span><span class="p">);</span></code></pre></figure></p>

<p>Hay ocasiones en que esta sintaxis (usar un método) tiene mucho sentido y le da significado al programa que está escribiendo, sin embargo, hay otras en las que es mejor usar un indizador. Por ejemplo, ¿no crees que, si usáramos un indizador, nuestro código tendría más sentido?</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">griego</span> <span class="p">=</span> <span class="n">Alphabet</span><span class="p">.</span><span class="n">Greek</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">segundaLetra</span> <span class="p">=</span> <span class="n">griego</span><span class="p">[</span><span class="m">2</span><span class="p">];</span></code></pre></figure></p>

<p>El indizador para la clase <code>Alphabet</code> se ve así:</p>

<p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="kt">char</span> <span class="k">this</span><span class="p">[</span><span class="kt">int</span> <span class="n">i</span><span class="p">]</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">caracteres</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure></p>

<h2 id=\"ejemplos\">Ejemplos</h2>
<p>Además de los ya mencionados, en el framework de .NET y en algunos otros muy usados, los indizadores son uno de los elementos más empleados. Por ejemplo, uno de los lugares más comunes en donde aparecen es en los tipos de dato <code>string</code>.</p>

<p>Cuando trabajamos con WebForms, la variable <code>Session</code> también implementa un indizador que recibe una cadena para acceder a los valores que hemos almacenado en ella previamente.</p>

<p>Recuerda que puedes <a href=\"https://github.com/ThatCSharpGuy/aprende-c-sharp/tree/master/Indizadores\" target=\"_blank\">descargar el código fuente</a> de los ejemplos para que practiques con él, y que cualquier duda de la puedes hacer llegar usando los botones de contacto de abajo.</p>
"
}