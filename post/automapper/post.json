{	
	"id" : "/post/automapper/",
	"tv" : false,
	"date": "2016-03-28 13:00:00 -0600",
	"title" : "AutoMapper",
	"author" : "Antonio Feregrino Bolaños",
	"featured_image": "http://thatcsharpguy.com/postimagesfeatured.png",
	"tags" :
	[ 
		"NuGetRecomendado"
	],
	"content" : "<p>Hay muchas razones por las que como desarrolladores nos podemos ver en la necesidad de transferir, o mapear, información de un objeto a otro. Una de estas razones es para evitar el <a href=\"https://en.wikipedia.org/wiki/Mass_assignment_vulnerability\" target=\"_blank\" rel=\"nofollow\">Overposting</a>.</p>

<p>En general se emplea el mapeo en los límites entre componentes de un sistema, ya sea de la base de datos a la capa de lógica, de la lógica a la interfaz gràfica o de un servicio web de un tercero a nuestra app. El hecho de que existan los mapeos favorece la separación de responsabilidades en el código.</p>

<p>Por ejemplo, cuando estamos trabajando con servicios web y recibimos un objeto simple y lo queremos transformar en algo con lo que nuestra aplicaciòn pueda trabajar, otro ejemplo es cuando somos nosotros los que enviamos la información de nuestra aplicación a través de un servicio web, sin embargo no queremos que el receptor tenga acceso a toda la información que tenemos disponible.</p>

<h2 id=\"ejemplo-prctico\">Ejemplo práctico</h2>
<p>Supongamos que tenemos un servicio web que sirve para consultar información sobre libros, de nuestra base de datos recuperamos la información a través de las siguientes entidades:</p>

<div class=\"pure-g\">
<div class=\"pure-u-1 pure-u-md-1-2\">
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">BookEntity</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Subtitle</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Pages</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Edition</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">AuthorEntity</span> <span class="n">Author</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>  
</div>
<div class=\"pure-u-1 pure-u-md-1-2\">
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">AuthorEntity</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Age</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">bookentity</span><span class="p">&gt;</span> <span class="n">Books</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="p">}</span>
  </code></pre></figure>  
  


Responder a la petición de un usuario con dichas clases, representaría dar más información de la que se necesita, es por eso usaremos estas clases para responder a cada petición:

<div class=\"pure-g\">
<div class=\"pure-u-1 pure-u-md-1-2\">
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">BookModel</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FullTitle</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Pages</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Edition</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">AuthorName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">TimeSent</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>  
</div>
<div class=\"pure-u-1 pure-u-md-1-2\">
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">AuthorModel</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Age</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">BooksCount</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
  
  </code></pre></figure>  
</div>  
</div>

Ahora bien, podríamos pensar en hacerlo manualmente:

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">modeloAutor</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AuthorModel</span><span class="p">();</span>
<span class="n">modeloAutor</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">entidadAutor</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
<span class="n">modeloAutor</span><span class="p">.</span><span class="n">Age</span> <span class="p">=</span> <span class="n">entidadAutor</span><span class="p">.</span><span class="n">Age</span><span class="p">;</span>
<span class="n">modeloAutor</span><span class="p">.</span><span class="n">BooksCount</span> <span class="p">=</span> <span class="n">entidadAutor</span><span class="p">.</span><span class="n">Books</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="n">entidadAutor</span><span class="p">.</span><span class="n">Books</span><span class="p">.</span><span class="n">Count</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span></code></pre></figure>  

Pero no es una tarea sencilla si nuestros objetos comienzan a crecer en tamaño o complejidad... y ni hablar de lo aburrido que puede llegar a ser escribir cada mapeo \"a mano\". 

## AutoMapper  
Es por eso que a <a href=\"https://github.com/jbogard\" target=\"_blank\" rel=\"nofollow\">Jimmy Bogard</a> se le ocurrió la idea de crear AutoMapper, que es una pequeña librería que nos ayudará a automatizar esta tarea. 

AutoMapper es un mapeador objeto-objeto que \"convierte\" un objeto de un tipo a otro, sin embargo lo que hace realmente útil a esta herramienta es que facilita la tarea mediante el uso de convenciones de código, que le ayudan a decidir qué propiedad de un tipo se mapea al otro. 

### Configuración
Para comenzar a usar AutoMapper demebos configurarlo, para lo cual utilizaremos una instancia de la clase `MapperConfiguration`, a través del que configuraremos el mapeo:

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">automappingConfiguration</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AutoMapper</span><span class="p">.</span><span class="n">MapperConfiguration</span><span class="p">(</span><span class="n">config</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="p">{</span>
    <span class="c1">// Configurar mapeo</span></code></pre></figure>  

#### Convenciones  

A partir de aquí se tiene que configurar cada mapeo objeto-objeto individualmente, necesitaremos dos tipos de dato una *fuente* y un *destino*, utilizando la variable `config` y su método `CreateMap` es como se realiza la tarea. Por ejemplo, para configurar el mapeo de `AuthorEntity` (la fuente) a `AuthorModel` (el destino) basta con una sola línea:

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">config</span><span class="p">.</span><span class="n">CreateMap</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">AuthorEntity</span><span class="p">,</span> <span class="n">AuthorModel</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;();</span></code></pre></figure>  

Esto se debe a que para este mapeo utiliza las convenciones definidas por AutoMapper:  
  
 - Ambos tienen `Nombre` del tipo `string`  
 - Ambos tienen `Age` del tipo `int`
 - para `BooksCount` en el destino, AutoMapper busca una colección `Books`, y obtendrá el número de elementos que contiene.
 
 Esto hace que el mapeo sea automático entre las dos propiedades, estas convenciones están incluídas en la librería, sin embargo <a href=\"https://lostechies.com/joshuaflanagan/2010/03/19/teaching-automapper-about-our-conventions/\" target=\"_blank\" rel=\"nofollow\">podemos definir las nuestras</a>. 
 
#### Personalizado  
 
 Si tenemos unpar de objetos que requieren de un mapeo más complejo, tenemos a nuestra disposición algunos métodos adicionales, que nos ayudarán a configurar a mayor profundidad AutoMapper, toma por ejemplo las dos entidades `BookEntity` (la fuente) a `BookModel` (el destino):
 
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">config</span><span class="p">.</span><span class="n">CreateMap</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">BookEntity</span><span class="p">,</span> <span class="n">BookModel</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;()</span>
    <span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">dest</span><span class="p">.</span><span class="n">AuthorName</span><span class="p">,</span> 
        <span class="n">opt</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">opt</span><span class="p">.</span><span class="n">ResolveUsing</span><span class="p">(</span><span class="n">entity</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">entity</span><span class="p">.</span><span class="n">Author</span><span class="p">.</span><span class="n">Name</span><span class="p">))</span>
    <span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">dest</span><span class="p">.</span><span class="n">FullTitle</span><span class="p">,</span>
        <span class="n">opt</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">opt</span><span class="p">.</span><span class="n">ResolveUsing</span><span class="p">(</span><span class="n">entity</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">entity</span><span class="p">.</span><span class="n">Title</span> <span class="p">+</span> <span class="err">\</span><span class="s">&quot; \&quot; + entity.Subtitle))</span>
    <span class="p">.</span><span class="n">ForMember</span><span class="p">(</span><span class="n">dest</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">dest</span><span class="p">.</span><span class="n">TimeSent</span><span class="p">,</span> <span class="n">opt</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">opt</span><span class="p">.</span><span class="n">Ignore</span><span class="p">());</span></code></pre></figure>  
 
Veamos por partes lo que está sucediendo en el código anterior:

 1. Con `config.CreateMap&lt;BookEntity, BookModel&gt;()` estamos indicando el inicio de una configuración de mapeo.  
 2. Con el método `ForMember` le estamos indicando que la propiedad `AuthorName` en el destino la debe obtener de `Author.Name` en la fuente
 3. Al igual que en la anterior, le estamos diciendo que `FullTitle` la obtenga de concatenar `Title`, un espacio en blanco y `Subtitle` de la fuente
 4. El destino tiene una propiedad llamada `TimeSent` que no existe en la fuente, para asegurar que el mapeo sea correcto, le decimos a la configuración que la ignore mediante el método `Ignore`.

Para este ejemplo no se requiere de una configuración más compleja, sin embargo si tu aplicación la requiere, puedes checar <a href=\"https://github.com/AutoMapper/AutoMapper/wiki/Custom-value-resolvers\" target=\"_blank\" rel=\"nofollow\"><i>custom resolvers</i></a>, <a href=\"https://github.com/AutoMapper/AutoMapper/wiki/Custom-type-converters\" target=\"_blank\" rel=\"nofollow\"><i>custom type converters</i></a>, <a href=\"https://github.com/AutoMapper/AutoMapper/wiki/Conditional-mapping\" target=\"_blank\" rel=\"nofollow\">mapeo condicional</a> o cualquier otra de las posibilidades que puedes consultar en la <a href=\"https://github.com/AutoMapper/AutoMapper/wiki\" target=\"_blank\" rel=\"nofollow\">documentación de AutoMapper</a>. 

### Uso

Una vez que hemos <a href=\"#configuracion\">configurado</a> el mapeo, debemos llamar al método `CreateMapper` de la clase `MapperConfiguration`

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">mapper</span> <span class="p">=</span> <span class="n">automappingConfiguration</span><span class="p">.</span><span class="n">CreateMapper</span><span class="p">();</span></code></pre></figure>  

la cual nos devolverá una instancia de un objeto que implementa `IMapper`, que es a través del cual se realizará cada mapeo. Luego, con esta instancia a nuestra disposición, bastará con llamar a `Map` pasándole una instancia de la fuente (desde la que queremos mapear) y el tipo del destino (al que queremos llegar):

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="c1">// De AuthorEntity a AuthorModel</span>
<span class="kt">var</span> <span class="n">modeloAutor</span> <span class="p">=</span> <span class="n">mapper</span><span class="p">.</span><span class="n">Map</span><span class="p">&lt;</span><span class="n">authormodel</span><span class="p">&gt;(</span><span class="n">entidadAutor</span><span class="p">);</span>

<span class="c1">// De BookEntity a BookModel</span>
<span class="kt">var</span> <span class="n">modeloLibro</span> <span class="p">=</span> <span class="n">mapper</span><span class="p">.</span><span class="n">Map</span><span class="p">&lt;</span><span class="n">bookmodel</span><span class="p">&gt;(</span><span class="n">bookEntity</span><span class="p">);</span></code></pre></figure>

Como podrás ver, podemos centralizar bastante la tarea de mapeo, y es que en tu aplicación **basta con tener una sola referencia a `IMapper`**, así que es lo normal que únicamente la asignes una vez y la reutilizes a través de una propiedad estática o un patrones de diseño de aplicaciones como DI o singleton.

## Conclusión
Este post apenas y roza la superficie de todo las posibilidades que AutoMapper tiene para nosotros y no cabe duda de que después de adentrarte en la documentación podrás encontrarle más utilidad. Además de que AutoMapper también es fácilmente integrable con patrones de diseño, incluyendo la Inyección de Dependencias. Si existe algo en lo que estés atorado con la configuración, tal vez pueda ayudar.
 
# Instalación  
Para instalarlo no hay mejor manera que el gestor de paquetes de NuGet:

<figure class="console"><pre><code>PM&gt; Install-Package AutoMapper</code></pre></figure>

O échale un ojo al <a href=\"https://github.com/AutoMapper/AutoMapper\" target=\"_blank\" rel=\"nofollow\">proyecto en GitHub</a> y contribuir a su desarrollo de alguna manera.
</bookmodel></authormodel></bookentity></div></div>
"
}