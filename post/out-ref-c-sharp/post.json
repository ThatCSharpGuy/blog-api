{	
	"id" : "/post/out-ref-c-sharp/",
	"tv" : false,
	"date": "2016-04-11 14:00:01 -0500",
	"title" : "out y ref en C#",
	"author" : "Antonio Feregrino Bolaños",
	"featured_image": "http://thatcsharpguy.com/postimages//aprende-c-sharp/ref-out.png",
	"tags" : ["AprendeCSharp"],
	  
	"content": '"En un post anterior hablé acerca de <a href=\"../metodos-c-sharp\">métodos en C#</a>, ahí mencioné que los parámetros que recibía un método nos daban muchas posibilidades a la hora de desarrollar, y la característica de la que hablaré es otra de esas posibilidades.\n\nSeguramente si en alguna vez de tu carrera has usado código C o C++ te has encontrado con estos operadores: `*` o  `&` que, en pocas palabras, nos sirven para trabajar con punteros y también sabrás que estos nos permitían pasar como referencia una variable, entonces ya sabíamos que para modificar el valor de una variable dentro de una función teníamos que pasar el apuntador a dicho objeto como argumento.\n\nPues bien, en C# existen las palabras `ref` y `out` que vienen a realizar una tarea similar ya que al usarlos para declarar y llamar a algún método, permiten que el argumento sea pasado por referencia (digamos que algo \"similar\" a los punteros) y no por valor.\n\n### Declaración\n\nSi deseamos emplear valores por referencia en algún método, es necesario expresarlo desde su definción:\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">npublic</span> <span class="k">void</span> <span class="n">Swap</span><span class="p">(</span><span class="k">ref</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="c1">// ...\npublic bool SumaMaxima(int a, int b, int max, out int resultado) // ...\npublic string WeirdMethod(ref int a, ref int b, out int s, out int r) // ...\n</span></code></pre></figure>  \n\nEn el primer caso, vemos que tanto `a` como `b` son enteros que el método recibe por referencia. En el segundo, únicamente `resultado` es una referencia y en el tercero `a`, `b`, `s` y `r` son pasados de esta manera.\n\nPara trabajar con las referencias dentro del método no tenemos que hacer nada especial, podemos usarlas como si fueran parámetros normales:\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">npublic</span> <span class="k">void</span> <span class="n">Swap</span><span class="p">(</span><span class="k">ref</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="kt">int</span> <span class="n">m</span> <span class="p">=</span> <span class="n">a</span><span class="p">;</span><span class="err">\</span><span class="n">n</span>    <span class="n">a</span> <span class="p">=</span> <span class="n">b</span><span class="p">;</span><span class="err">\</span><span class="n">n</span>    <span class="n">b</span> <span class="p">=</span> <span class="n">m</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="n">npublic</span> <span class="kt">bool</span> <span class="n">SumaMaxima</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max</span><span class="p">,</span> <span class="k">out</span> <span class="kt">int</span> <span class="n">resultado</span><span class="p">)</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="n">resultado</span> <span class="p">=</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span><span class="p">;</span><span class="err">\</span><span class="n">n</span>    <span class="k">if</span> <span class="p">(</span><span class="n">resultado</span> <span class="p">&gt;=</span> <span class="n">max</span><span class="p">)</span><span class="err">\</span><span class="n">n</span>    <span class="p">{</span><span class="err">\</span><span class="n">n</span>        <span class="n">resultado</span> <span class="p">=</span> <span class="n">max</span><span class="p">;</span><span class="err">\</span><span class="n">n</span>        <span class="k">return</span> <span class="k">true</span><span class="p">;</span><span class="err">\</span><span class="n">n</span>    <span class="p">}</span><span class="err">\</span><span class="n">n</span>    <span class="k">return</span> <span class="k">false</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="n">npublic</span> <span class="kt">string</span> <span class="n">WeirdMethod</span><span class="p">(</span><span class="k">ref</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="k">out</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="k">out</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="n">s</span> <span class="p">=</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span><span class="p">;</span><span class="err">\</span><span class="n">n</span>    <span class="n">r</span> <span class="p">=</span> <span class="n">a</span> <span class="p">-</span> <span class="n">b</span><span class="p">;</span><span class="err">\</span><span class="n">n</span>    <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="n">b</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span></code></pre></figure>  \n\n### Uso  \n\nPara usarlos, también es necesario indicar en la llamada al método que los parámetros deben ser pasados de determinado modo, fíjate en la llamada a `Swap` en el siguiente código\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">nint</span> <span class="n">a</span> <span class="p">=</span> <span class="m">100</span><span class="p">,</span> <span class="n">b</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span><span class="err">\</span><span class="n">nConsole</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">\</span><span class="s">&quot;Valor de a:\&quot; + a + \&quot; - Valor de b:\&quot; + b);\n\nparametros.Swap(ref a, ref b);\n\nConsole.WriteLine(\&quot;Valor de a:\&quot; + a + \&quot; - Valor de b:\&quot; + b);\n</span></code></pre></figure>  \n\nEl resultado es el siguiente\n\n<pre>\nValor de a:100 - Valor de b:5  \nValor de a:5 - Valor de b:100\n</pre>\n\nY esta es una llamada a un método con `out`\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">nint</span> <span class="n">resSuma</span><span class="p">;</span><span class="err">\</span><span class="n">nvar</span> <span class="n">isResultOk</span> <span class="p">=</span> <span class="n">parametros</span><span class="p">.</span><span class="n">SumaMaxima</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="k">out</span> <span class="n">resSuma</span><span class="p">);</span><span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="n">nif</span> <span class="p">(</span><span class="n">isResultOk</span><span class="p">)</span><span class="err">\</span><span class="n">n</span>    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">\</span><span class="s">&quot;La suma excedió el valor máximo\&quot;);\nelse\n    Console.WriteLine(\&quot;El resultado de la suma es \&quot; + resSuma);\n</span></code></pre></figure>  \n\nQue da como resultado\n```\nLa suma excedió el valor máximo\n```\n\n### La diferencia entre ref y out\n\nHasta ahora parecen similares, sin embargo, mientras que ambas son referencias, la semántica que tienen es distinta.\n\n+*Debemos usar `out` cuando se espera que sea el método llamado el encargado de asignarle valor**, así que si creas un método con un parámetro del tipo `out` y no le asignas valor dentro del mismo, el compilador te dará un error. Por ejemplo, si la definición de `WeirdMethod` fuera la siguiente:\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">npublic</span> <span class="kt">string</span> <span class="n">WeirdMethod</span><span class="p">(</span><span class="k">ref</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="k">out</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="k">out</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="err">\</span><span class="n">n</span>    <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="n">b</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span><span class="err">\</span><span class="n">n</span><span class="p">}</span><span class="err">\</span><span class="n">n</span></code></pre></figure>  \n\nObtendríamos un error como este: `The out parameter 'r' must be assigned to before control leaves the current method`.\n\nAdemás, **la variable que le pasamos como `out` puede o no estar inicializada antes de ser enviada al método** sin que el compilador genere siquiera una advertencia.\n\n### Ejemplo de la vida real\nExisten muchos escenarios en los que podemos usar el paso por referencia en nuestros programas, pero uno de los ejemplos màs significativos son los métodos `TryParse`, que reciben un parámetro `out` y regresan un valor `bool`. En ellos se intenta hacer la conversión de cadena al tipo de dato especificado y devuelven verdadero o falso dependiendo de si la conversión resultó exitosa, y en caso de que si, el valor vendrá asignada en el parámetro marcado:\n\n<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="err">\</span><span class="n">nstring</span> <span class="n">dec</span> <span class="p">=</span> <span class="err">\</span><span class="s">&quot;abcd\&quot;;\nstring dec2 = \&quot;555\&quot;;\n\ndecimal one;\ndecimal two;\n\nif (Decimal.TryParse(dec, out one))\n    Console.WriteLine(\&quot;Convertí \&quot; + dec + \&quot; en \&quot; + one);\nelse\n    Console.WriteLine(dec  + \&quot; no es convertible a decimal\&quot;);\n\n\nif (Decimal.TryParse(dec2, out two))\n    Console.WriteLine(\&quot;Convertí \&quot; + dec2 + \&quot; en \&quot; + two);\nelse\n    Console.WriteLine(dec  + \&quot; no es convertible a decimal\&quot;);\n</span></code></pre></figure>   \n\n### Lo que sigue\n\nTe invito a que pruebes con el código que acompaña al post y que si tienes alguna duda me la hagas saber en Twitter o al correo electrónico. En realidad no es muy común que tu tengas que implementar los parámetos de este tipo en tu código, sin embargo si se puede presentar el caso y no hay más que estar preparado y conocerlos."'   
}